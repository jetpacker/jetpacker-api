---
- set_fact:
    host_node_modules: "{{ project }}/node_modules"
    guest_node_modules: "~/node_cache/{{ project }}/node_modules"

- block:
    - file: path="{{ host_node_modules }}" state=absent owner=vagrant group=vagrant
    - file: path="{{ host_node_modules }}" state=directory owner=vagrant group=vagrant recurse=yes
    - file: path="{{ guest_node_modules }}" state=directory owner=vagrant group=vagrant recurse=yes
    - command: bash -lc "sudo mount --bind {{ guest_node_modules }} {{ host_node_modules }}"
  become: yes
  become_user: vagrant